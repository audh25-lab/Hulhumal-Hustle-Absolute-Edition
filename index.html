<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Hulhumal√© Hustle ‚Äî MAXIMUM OVERDRIVE</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<style>
:root{
 --neon:#00ffd0;
 --hot:#ff3b7a;
 --bg:#020406;
}
html,body{
 margin:0;padding:0;
 background:radial-gradient(circle at top,#071a22,#000);
 color:var(--neon);
 font-family:monospace;
 overflow:hidden;
}
canvas{display:block;margin:auto}
.screen{
 position:absolute;inset:0;
 background:rgba(0,0,0,.96);
 display:flex;flex-direction:column;
 align-items:center;justify-content:center;
 text-align:center;z-index:10;
}
h1,h2{text-shadow:0 0 20px var(--neon)}
button{
 background:linear-gradient(45deg,var(--neon),#0ff);
 border:none;padding:14px 26px;
 font-family:monospace;font-size:16px;
 border-radius:10px;
 box-shadow:0 0 25px var(--neon);
}
#hud{
 position:absolute;top:8px;left:0;right:0;
 text-align:center;font-size:14px;
 text-shadow:0 0 12px var(--neon);
}
#settings{
 position:absolute;bottom:6px;left:0;right:0;
 background:rgba(0,0,0,.7);
 font-size:12px;padding:6px;text-align:center
}
#touch{
 position:absolute;bottom:80px;left:0;right:0;
 display:flex;justify-content:center;gap:14px
}
.touchBtn{
 width:58px;height:58px;border-radius:16px;
 background:radial-gradient(circle,#0ff,var(--neon));
 color:#000;font-size:22px;
 display:flex;align-items:center;justify-content:center;
 box-shadow:0 0 25px var(--neon)
}
#minimap{
 position:absolute;right:8px;top:48px;
 width:120px;height:120px;
 background:#000;border:1px solid var(--neon)
}
</style>
</head>
<body>

<div id="title" class="screen">
<h1>üèùÔ∏è Hulhumal√© Hustle</h1>
<h2>MAXIMUM OVERDRIVE</h2>
<p>Story ‚Ä¢ Co-Op ‚Ä¢ Boss Gangs ‚Ä¢ 3D Neon</p>
<button onclick="startGame()">START</button>
</div>

<div id="story" class="screen" style="display:none"></div>
<div id="end" class="screen" style="display:none"></div>

<div id="hud"></div>
<div id="settings">
Glow <input type="checkbox" id="glow" checked>
Depth <input type="range" id="depth" min="0.3" max="1.2" step="0.1" value="0.9">
Particles <input type="checkbox" id="fx" checked>
Scan <input type="checkbox" id="scan" checked>
</div>

<canvas id="c" width="720" height="720"></canvas>
<canvas id="minimap" width="120" height="120"></canvas>

<div id="touch">
<div class="touchBtn" ontouchstart="dir(0,-1)">‚¨Ü</div>
<div class="touchBtn" ontouchstart="dir(-1,0)">‚¨Ö</div>
<div class="touchBtn" ontouchstart="dir(1,0)">‚û°</div>
<div class="touchBtn" ontouchstart="dir(0,1)">‚¨á</div>
</div>

<script>
/* ================= CORE ================= */
const c=document.getElementById("c"),ctx=c.getContext("2d");
const m=document.getElementById("minimap").getContext("2d");
const hud=document.getElementById("hud"),story=document.getElementById("story");
const TILE=28,ROWS=25,COLS=25;
let level=1,score=0,lives=5,power=0,night=false,running=false,ended=false;
let depth=0.9,shake=0;
let hs=localStorage.hhHS||0;
let particles=[];

/* ================= AUDIO ================= */
let AC;
function audio(){if(!AC)AC=new(window.AudioContext||webkitAudioContext)();}
function beat(f){
 if(!AC)return;
 const o=AC.createOscillator(),g=AC.createGain();
 o.type="sawtooth";o.frequency.value=f;
 o.connect(g);g.connect(AC.destination);
 o.start();g.gain.exponentialRampToValueAtTime(.001,AC.currentTime+.18);
 o.stop(AC.currentTime+.18);
}

/* ================= MAP ================= */
function genMap(addu=false){
 let m=[];
 for(let y=0;y<ROWS;y++){
  m[y]=[];
  for(let x=0;x<COLS;x++){
   if(x==0||y==0||x==COLS-1||y==ROWS-1||
     (addu?(y%4==0&&x%3):(x%4==0&&y%3))) m[y][x]=1;
   else m[y][x]=Math.random()<.06?3:2;
  }
 }
 return m;
}
let map;

/* ================= PLAYERS ================= */
const p1={x:1,y:1,dx:0,dy:0,icon:"üòé"};
const p2={x:1,y:2,dx:0,dy:0,icon:"ü§ù"};

onkeydown=e=>{
 audio();
 const k=e.key;
 if(k.includes("Arrow")){
  if(k=="ArrowUp")[p1.dx,p1.dy]=[0,-1];
  if(k=="ArrowDown")[p1.dx,p1.dy]=[0,1];
  if(k=="ArrowLeft")[p1.dx,p1.dy]=[-1,0];
  if(k=="ArrowRight")[p1.dx,p1.dy]=[1,0];
 }
 if("wasd".includes(k)){
  if(k=="w")[p2.dx,p2.dy]=[0,-1];
  if(k=="s")[p2.dx,p2.dy]=[0,1];
  if(k=="a")[p2.dx,p2.dy]=[-1,0];
  if(k=="d")[p2.dx,p2.dy]=[1,0];
 }
};
function dir(dx,dy){audio();[p1.dx,p1.dy]=[dx,dy]}

/* ================= GANGS ================= */
const gangsDB={
 male:{C:["Low Tide","Breakwater Boys","Red Buoy"],
       B:["Boru Park","Dotfall","Iron Jetty"],
       A:["Henvari Syndicate","Masuun Crew","Vaika Circle","North Coil"]},
 addu:{C:["Son of Salts","6 Beys","Jo Lians"],
       B:["Milo Juice City","Xe Pear"],
       A:["Lions","Sand Paper","MBH"]}
};
let gangs=[];
function spawn(){
 let r=level<7?"male":"addu";
 let t=level%5==0?"A":level%3==0?"B":"C";
 return gangsDB[r][t].map((n,i)=>({
  name:n,x:COLS-2-i,y:ROWS-2-i,dx:0,dy:0,
  speed:(t=="C"?1:t=="B"?2:3)+(night?1:0),
  hp:n=="MBH"?14:(t=="A"?3:1),
  icon:n=="MBH"?"üíÄ":t=="A"?"üëπ":t=="B"?"ü§¨":"üòà"
 }));
}

/* ================= STORY ================= */
function cut(t){
 story.innerHTML=t+"<br><br><small>Tap</small>";
 story.style.display="flex";
 story.onclick=()=>story.style.display="none";
}

/* ================= LOGIC ================= */
function move(o){
 let nx=o.x+o.dx,ny=o.y+o.dy;
 if(map[ny][nx]!=1){o.x=nx;o.y=ny}
}
function ai(g){
 let target=power?{x:Math.random()*COLS,y:Math.random()*ROWS}:p1;
 let dirs=[[1,0],[-1,0],[0,1],[0,-1]];
 let best=dirs[0],d=1e9;
 dirs.forEach(v=>{
  let nx=g.x+v[0],ny=g.y+v[1];
  if(map[ny][nx]==1)return;
  let dd=Math.hypot(target.x-nx,target.y-ny);
  if(dd<d){d=dd;best=v}
 });
 [g.dx,g.dy]=best;
}
function spark(x,y,col){
 if(!document.getElementById("fx").checked)return;
 for(let i=0;i<8;i++)particles.push({
  x,y,vx:(Math.random()-.5)*2,vy:(Math.random()-.5)*2,
  l:20,c:col
 });
}

function update(){
 if(!running||ended)return;
 [p1,p2].forEach(move);
 [p1,p2].forEach(p=>{
  if(map[p.y][p.x]==2){map[p.y][p.x]=0;score+=10;beat(420);spark(p.x,p.y,var(--neon))}
  if(map[p.y][p.x]==3){map[p.y][p.x]=0;power=260;beat(880)}
 });
 gangs.forEach(g=>{
  for(let i=0;i<g.speed;i++){ai(g);move(g)}
  [p1,p2].forEach(p=>{
   if(g.x==p.x&&g.y==p.y){
    if(power){g.hp--;score+=200;shake=8}
    else{lives--;shake=14;p.x=1;p.y=1}
   }
  });
 });
 gangs=gangs.filter(g=>g.hp>0);
 if(power)power--;
 if(!gangs.length){
  level++;night=level%4==0;
  map=genMap(level>=7);gangs=spawn();
  if(level==1)cut("Mal√© streets. Neon nights.");
  if(level==7)cut("Addu blocks. No mercy.");
  if(gangs.some(g=>g.name=="MBH"))cut("MBH controls everything.");
  if(level>14){
   ended=true;hs=Math.max(hs,score);localStorage.hhHS=hs;
   document.getElementById("end").innerHTML=
   "<h1>üèÜ MBH DEFEATED</h1><p>Score "+score+"</p><button onclick='location.reload()'>RESTART</button>";
   document.getElementById("end").style.display="flex";
  }
 }
}

/* ================= DRAW ================= */
function iso(x,y,z=0){
 return{
  x:c.width/2+(x-y)*TILE+(Math.random()-.5)*shake,
  y:90+(x+y)*TILE*.5-z+(Math.random()-.5)*shake
 };
}
function draw(){
 ctx.clearRect(0,0,c.width,c.height);
 ctx.shadowBlur=document.getElementById("glow").checked?16:0;
 ctx.shadowColor=night?"#0ff":"#00ffd0";

 for(let y=0;y<ROWS;y++)for(let x=0;x<COLS;x++){
  if(map[y][x]==1){
   let p=iso(x,y,depth*TILE);
   ctx.fillStyle=night?"#011":"#033";
   ctx.fillRect(p.x,p.y,TILE,TILE*.5);
  }
  if(map[y][x]==2){let p=iso(x,y);ctx.fillText("üçç",p.x,p.y)}
  if(map[y][x]==3){let p=iso(x,y);ctx.fillText("ü•§",p.x,p.y)}
 }
 function ch(o){
  let p=iso(o.x,o.y,TILE*.5);
  ctx.font="22px monospace";ctx.textAlign="center";
  ctx.fillText(o.icon,p.x,p.y);
 }
 ch(p1);ch(p2);gangs.forEach(ch);

 particles=particles.filter(p=>p.l--);
 particles.forEach(p=>{
  let q=iso(p.x,p.y);
  ctx.fillStyle=p.c;ctx.fillRect(q.x,q.y,2,2);
  p.x+=p.vx*.1;p.y+=p.vy*.1;
 });

 if(document.getElementById("scan").checked){
  ctx.fillStyle="rgba(0,0,0,.18)";
  for(let i=0;i<c.height;i+=3)ctx.fillRect(0,i,c.width,1);
 }
 hud.innerText=`Lvl ${level} Lives ${lives} Score ${score} HS ${hs} ${night?"üåô":""}`;

 m.clearRect(0,0,120,120);
 m.fillStyle="#0ff";
 m.fillRect(p1.x*4,p1.y*4,4,4);
 gangs.forEach(g=>m.fillRect(g.x*4,g.y*4,4,4));
 shake=Math.max(0,shake-1);
}

/* ================= LOOP ================= */
function loop(){update();draw();if(running)requestAnimationFrame(loop)}
function startGame(){
 document.getElementById("title").style.display="none";
 running=true;map=genMap();gangs=spawn();loop();
}
document.getElementById("depth").oninput=e=>depth=e.target.value;
</script>
</body>
</html>
