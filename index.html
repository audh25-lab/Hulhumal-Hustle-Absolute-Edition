<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Hulhumal√© Hustle ‚Äì Absolute Edition</title>
<style>
body{margin:0;background:#000;color:#00ffd0;font-family:monospace;text-align:center}
canvas{border:4px solid #00ffd0;background:#040404;touch-action:none}
#ui,#gang,#cutscene{
 position:absolute;left:0;right:0;margin:auto;color:#0fc
}
#cutscene{
 top:0;bottom:0;
 background:rgba(0,0,0,.92);
 display:none;
 flex-direction:column;
 justify-content:center;
 font-size:18px;
 padding:40px;
}
</style>
</head>
<body>

<h2>üèùÔ∏è Hulhumal√© Hustle: Island Wars</h2>
<div id="ui"></div>
<div id="gang"></div>
<div id="cutscene"></div>
<canvas id="c" width="600" height="600"></canvas>

<script>
/* ===== CORE ===== */
const c=document.getElementById("c"),x=c.getContext("2d");
const ui=document.getElementById("ui");
const gangUI=document.getElementById("gang");
const cut=document.getElementById("cutscene");

const TILE=24,ROWS=25,COLS=25;
let level=1,score=0,lives=5,power=0,night=false,ended=false;
let hs=localStorage.hhHS||0;

/* ===== AUDIO ===== */
const AC=new (window.AudioContext||webkitAudioContext)();
function beat(freq,d=0.2){
 const o=AC.createOscillator(),g=AC.createGain();
 o.frequency.value=freq;
 o.connect(g);g.connect(AC.destination);
 o.start();
 g.gain.exponentialRampToValueAtTime(.0001,AC.currentTime+d);
 o.stop(AC.currentTime+d);
}

/* ===== STORY ===== */
function showStory(t){
 cut.innerHTML=t+"<br><br><small>Tap / Click / Key</small>";
 cut.style.display="flex";
 cut.onclick=()=>cut.style.display="none";
}

/* ===== MAP ===== */
function genMap(addu=false){
 const m=[];
 for(let y=0;y<ROWS;y++){
  m[y]=[];
  for(let x=0;x<COLS;x++){
   if(x===0||y===0||x===COLS-1||y===ROWS-1||
     (addu?(y%4===0&&x%3):(x%4===0&&y%3)))
    m[y][x]=1;
   else m[y][x]=Math.random()<0.06?3:2;
  }
 }
 return m;
}
let map=genMap();

/* ===== PLAYERS ===== */
const p1={x:1,y:1,dx:0,dy:0,icon:"üòé"};
const p2={x:1,y:2,dx:0,dy:0,icon:"ü§ù"};

onkeydown=e=>{
 if(e.key.includes("Arrow")){
  if(e.key.includes("Up"))[p1.dx,p1.dy]=[0,-1];
  if(e.key.includes("Down"))[p1.dx,p1.dy]=[0,1];
  if(e.key.includes("Left"))[p1.dx,p1.dy]=[-1,0];
  if(e.key.includes("Right"))[p1.dx,p1.dy]=[1,0];
 }
 if("wasd".includes(e.key.toLowerCase())){
  if(e.key==="w")[p2.dx,p2.dy]=[0,-1];
  if(e.key==="s")[p2.dx,p2.dy]=[0,1];
  if(e.key==="a")[p2.dx,p2.dy]=[-1,0];
  if(e.key==="d")[p2.dx,p2.dy]=[1,0];
 }
};

/* ===== GANG DATABASE ===== */
const gangsDB={
 male:{
  C:["Low Tide","Breakwater Boys","Red Buoy","Anchor Nine","Concrete Current"],
  B:["Boru Park","Dotfall","Brother Foot","Iron Jetty"],
  A:["Henvari Syndicate","Masuun Crew","Vaika Circle","North Coil","Bo Snare","Ell Tee"]
 },
 addu:{
  C:["Son of Salts","High Paper","6 Beys","Jo Lians"],
  B:["Milo Juice City","Xe Pear","Chis Wiss","4OA Land"],
  A:["Lions","East Waste Coats","Sand Paper","MBH"]
 }
};

/* ===== SPAWN ===== */
function spawn(){
 let list=[],region=level<7?"male":"addu";
 let tier=level%5===0?"A":level%3===0?"B":"C";
 let names=gangsDB[region][tier];
 names.slice(0,Math.min(3,level)).forEach((n,i)=>{
  list.push({
   name:n,
   x:COLS-2-i,y:ROWS-2-i,dx:0,dy:0,
   speed:(tier==="C"?1:tier==="B"?2:3)+(night?1:0),
   hp:n==="MBH"?6:tier==="A"?2:1,
   icon:n==="MBH"?"üíÄ":tier==="A"?"üëπ":tier==="B"?"ü§¨":"üòà"
  });
 });
 gangUI.innerText=`${region.toUpperCase()} ‚Ä¢ ${tier}-TIER`;
 setTimeout(()=>gangUI.innerText="",2000);
 return list;
}
let gangs=spawn();

/* ===== LOGIC ===== */
function move(o){
 let nx=o.x+o.dx,ny=o.y+o.dy;
 if(map[ny][nx]!==1){o.x=nx;o.y=ny;}
}
function ai(g){
 let t=Math.random()<0.5?p1:p2;
 g.dx=Math.sign(t.x-g.x);
 g.dy=Math.sign(t.y-g.y);
}
function checkPlayer(p){
 if(map[p.y][p.x]===2){map[p.y][p.x]=0;score+=10;beat(500)}
 if(map[p.y][p.x]===3){map[p.y][p.x]=0;power=220;beat(900,0.3)}
}

function update(){
 if(ended) return;

 [p1,p2].forEach(move);
 [p1,p2].forEach(checkPlayer);

 gangs.forEach(g=>{
  for(let i=0;i<g.speed;i++){ai(g);move(g)}
  [p1,p2].forEach(p=>{
   if(g.x===p.x&&g.y===p.y){
    if(power){g.hp--;score+=150;beat(300)}
    else {lives--;p.x=1;p.y=1;beat(120,0.4)}
   }
  });
 });

 gangs=gangs.filter(g=>g.hp>0);
 if(power)power--;

 if(!gangs.length){
  level++;
  night=level%4===0;
  map=genMap(level>=7);
  gangs=spawn();

  if(level===1)showStory("Mal√© streets. Small crews. Fast feet.");
  if(level===7)showStory("South side. Addu heat rising.");
  if(gangs.some(g=>g.name==="MBH"))
   showStory("MBH runs everything. End it.");

  if(level>12 && !gangs.length){
   hs=Math.max(hs,score);localStorage.hhHS=hs;
   showStory("üèÜ MBH defeated.<br>Streets cleared.<br>Score: "+score);
   ended=true;
  }
 }
}

/* ===== DRAW ===== */
function drawT(px,py,t){
 x.font="18px monospace";
 x.textAlign="center";x.textBaseline="middle";
 x.fillText(t,px*TILE+12,py*TILE+12);
}
function draw(){
 x.clearRect(0,0,c.width,c.height);
 for(let y=0;y<ROWS;y++)for(let z=0;z<COLS;z++){
  if(map[y][z]===1){
   x.fillStyle=night?"#011":"#033";
   x.fillRect(z*TILE,y*TILE,TILE,TILE);
  }
  if(map[y][z]===2)drawT(z,y,"üçç");
  if(map[y][z]===3)drawT(z,y,"ü•§");
 }
 drawT(p1.x,p1.y,p1.icon);
 drawT(p2.x,p2.y,p2.icon);
 gangs.forEach(g=>drawT(g.x,g.y,power?"üò±":g.icon));
 ui.innerText=`Lvl:${level} Lives:${lives} Score:${score} HS:${hs} ${night?"üåô NIGHT":""}`;
}

setInterval(()=>{update();draw()},120);
</script>
</body>
</html>
